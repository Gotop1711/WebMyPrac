// var website_data={
//   about:{
//     slogan: "岐響-延展真實世界的無限可能",
//     description: "創立於2016 年，承襲多元的音樂風格，<br>利用真實採樣、數位編輯及後製技術，<br>延展音樂的無限可能，使每一個作品<br>成為獨一無二的聽覺饗宴。"
    
//   }
//   ,service: [
//     {
//       title:"配樂與編曲",
//       description:"原創音樂，Demo 製作，廣告、影視與遊戲配樂，編曲與樂曲重製"
//     },{
//       title:"音效製作",
//       description:"LOGO 與企業形象音效，廣告、影視與遊戲音效，網站特效音，手機鈴聲"
//     },{
//       title:"混音後製",
//       description:"歌手與樂手錄音，旁白錄製，音樂會現場錄音，後製編輯，混音與母帶處理"
//     },{
//       title:"數位製譜",
//       description:"樂譜電子檔製作，流行音樂、樂團譜製作，現代音樂、室內樂、交響樂總譜與分譜打印"
//     }
//   ],project:[
//     {
//       singer:{
//         name: "Akira",
//         img_url: "https://scontent-lhr3-1.xx.fbcdn.net/v/t1.0-1/p320x320/13567147_1712503615638623_6907762446740795206_n.jpg?oh=53ce691f15598ab8bbfb970de17c3046&oe=582EAD2F",
//         description: "台灣彰化縣出身，忠實LoveLive愛好者，也因為μ's而有契機與團隊成員相遇。愛好是唱歌和放空，希望能藉著歌曲為大家帶來笑容。"
//       },works:[
//         {
//           title: "Love Live-Medley",
//           description: "Akira的第一個作品終於和大家見面了喔喔喔！！！<br>由Akira用她獨特的方式詮釋她最愛的LoveLive組曲<br>「叶え、私たちの夢！」<br>謝謝18位女神讓我們看到的一切。<br>妳們所帶給我們的奇蹟，是我們一生的寶物。<br>μ's六週年生日快樂",
//           video_url: "https://www.youtube.com/embed/WFaxF7Xsmyo"
//         }
//       ]
      
//     },{
//       singer:{
//         name: "佐藤 Sato",
//        img_url: "http://dyverse.studio/img/Sato.jpg",
//         description: "嚮往著愛與勇氣<br>從家鄉魔界逃離來到人間界的屬性不明生物(?<br>以從事藝能活動來達到外交及傳遞幸福和希望的目的<br>希望能夠促進魔界和人間界的友好和合諧相處 ♥<br>不過有時說的是家鄉魔界的語言和文法<br>所以有時可能會和人類對不上拍(?<br>關於人類的一切不管是語言或是生活方式都還在學習中!"
    
//       },works:[
//       ]
      
//     }
//   ],track:[{"0":"1","id":"1","1":"\u6551\u8996\u82f1\u96c4","title":"\u6551\u8996\u82f1\u96c4","2":"","imgurl":"","3":"\u4f5c\u7de8\u66f2","job":"\u4f5c\u7de8\u66f2","4":"2011-10-28","date":"2011-10-28","5":"\u9ede\u775b\u79d1\u6280\u80a1\u4efd\u6709\u9650\u516c\u53f8","cooperation":"\u9ede\u775b\u79d1\u6280\u80a1\u4efd\u6709\u9650\u516c\u53f8","6":"http:\/\/www.ideabus.com.tw\/lazyeye\/index.php","cooperationurl":"http:\/\/www.ideabus.com.tw\/lazyeye\/index.php","7":"https:\/\/soundcloud.com\/yen-ho-lai\/sets\/sbas11e65afv","song":"https:\/\/soundcloud.com\/yen-ho-lai\/sets\/sbas11e65afv","8":"","introduction":""},{"0":"2","id":"2","1":"\u5546\u58f2\u7e41\u76db\u30a8\u30c8\u3099\u30ec\u30f3\u30b7\u3099\u30e3\u30fc","title":"\u5546\u58f2\u7e41\u76db\u30a8\u30c8\u3099\u30ec\u30f3\u30b7\u3099\u30e3\u30fc","2":"","imgurl":"","3":"\u4f5c\u7de8\u66f2\u2027Sound producer","job":"\u4f5c\u7de8\u66f2\u2027Sound producer","4":"2013-10-13","date":"2013-10-13","5":"\u6c5f\u6238\u5ddd\u533a\u5546\u5e97\u8857\u9023\u5408\u4f1a","cooperation":"\u6c5f\u6238\u5ddd\u533a\u5546\u5e97\u8857\u9023\u5408\u4f1a","6":"http:\/\/www.edogawakusyoren.jp","cooperationurl":"http:\/\/www.edogawakusyoren.jp","7":"https:\/\/soundcloud.com\/yen-ho-lai\/sets\/gph9twlqjq5x","song":"https:\/\/soundcloud.com\/yen-ho-lai\/sets\/gph9twlqjq5x","8":"","introduction":""},{"0":"3","id":"3","1":"AimSound Studio \u59d4\u8a17\u88fd\u4f5c","title":"AimSound Studio \u59d4\u8a17\u88fd\u4f5c","2":"","imgurl":"","3":"\u4f5c\u7de8\u66f2","job":"\u4f5c\u7de8\u66f2","4":"2013-11-01","date":"2013-11-01","5":"AimSound studio","cooperation":"AimSound studio","6":"http:\/\/www.aimsoundstudio.com\/","cooperationurl":"http:\/\/www.aimsoundstudio.com\/","7":"https:\/\/soundcloud.com\/yen-ho-lai\/sets\/aimsound-studio-commission","song":"https:\/\/soundcloud.com\/yen-ho-lai\/sets\/aimsound-studio-commission","8":"","introduction":""},{"0":"4","id":"4","1":"\u300a\u96e8\u843d\u837c\u863c\u300b","title":"\u300a\u96e8\u843d\u837c\u863c\u300b","2":"","imgurl":"","3":"\u4f5c\u7de8\u66f2.\u6df7\u97f3\u5f8c\u88fd.\u5176\u4ed6 Track - ","job":"\u4f5c\u7de8\u66f2.\u6df7\u97f3\u5f8c\u88fd.\u5176\u4ed6 Track - ","4":"2015-01-31","date":"2015-01-31","5":"Erotes Studio","cooperation":"Erotes Studio","6":"http:\/\/www.erotes-studio.com\/index.php\/8-news\/72-character-song","cooperationurl":"http:\/\/www.erotes-studio.com\/index.php\/8-news\/72-character-song","7":"https:\/\/soundcloud.com\/yen-ho-lai\/track-no02-short-ver","song":"https:\/\/soundcloud.com\/yen-ho-lai\/track-no02-short-ver","8":"","introduction":""},{"0":"5","id":"5","1":"\u03bc's Taiwan FM \u5f71\u50cf\u61c9\u63f4\u4f01\u5283","title":"\u03bc's Taiwan FM \u5f71\u50cf\u61c9\u63f4\u4f01\u5283","2":"","imgurl":"","3":"\u9304\u97f3.\u6df7\u97f3\u5f8c\u88fd","job":"\u9304\u97f3.\u6df7\u97f3\u5f8c\u88fd","4":"2016-03-19","date":"2016-03-19","5":"\u03bc's Taiwan FM \u5f71\u50cf\u61c9\u63f4\u5718\u968a","cooperation":"\u03bc's Taiwan FM \u5f71\u50cf\u61c9\u63f4\u5718\u968a","6":"https:\/\/www.facebook.com\/LoveLiveFMVProject\/?fref=ts","cooperationurl":"https:\/\/www.facebook.com\/LoveLiveFMVProject\/?fref=ts","7":"https:\/\/www.youtube.com\/watch?v=RbtXCxLjHYo&feature=youtu.be","song":"https:\/\/www.youtube.com\/watch?v=RbtXCxLjHYo&feature=youtu.be","8":"","introduction":""}]
//   ,studio_info:{
//     map_url:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3610.987844566249!2d121.4493023150089!3d25.169888283908893!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3442affa01ad75b1%3A0x62d2a67f2ff2f019!2zMjUx5paw5YyX5biC5reh5rC05Y2A6YSn5YWs6LevMjfomZ8!5e0!3m2!1szh-TW!2stw!4v1472910496616",
//     phone: "+886 937-968-966",
//     tele: "(02) 2623-4124",
//     website: "http://dyverse.studio" ,
//     mail: "dyverse.studio@gmail.com",
//     taxid: "4799 7907"
//   }
// };
var website_data={};
var api_url="http://dyverse.studio/api/command.php";

$.ajax({
  url: api_url,
  data: {
    type: "get",
    name: "website_data"
  },
  success: function(res){
    website_data_json=res;
    website_data=JSON.parse(res);
    var web_vm=new Vue({
      el: "#vue_app",
      data: website_data
    });
    init_all_tracks();
  }
});



window.requestAnimFrame = (function(){
    return window.requestAnimationFrame || //Chromium
        window.webkitRequestAnimationFrame || //Webkit
        window.mozRequestAnimationFrame || //Mozilla
        window.oRequestAnimationFrame || //Opera
        window.msRequestAnimationFrame || //IE
        function(callback){
            window.setTimeout(callback, 1000 / 60);
        };
})();

var color_yellow = "#c9a063";
var mouse_down=false;

$(window).mousedown(function(){
  mouse_down=true;
});
$(window).mouseup(function(){
  mouse_down=false;
});

$("#icon").hover(function(){
  
  $("#mainhalfcir").toggleClass("mainhalfcir_fast");
  $(".pointer").toggleClass("pointer_fast");
  $(".pointerb").toggleClass("pointerb_fast")
},function(){
  
  $("#mainhalfcir").toggleClass("mainhalfcir_fast");
  $(".pointer").toggleClass("pointer_fast");
  $(".pointerb").toggleClass("pointerb_fast")
});

function get_canvas_element_by_id(id){
  var c = document.getElementById(id);
  return c.getContext("2d");
}

var index_ctx=get_canvas_element_by_id("background_index");
var intro_ctx=get_canvas_element_by_id("background_intro");
var contact_ctx=get_canvas_element_by_id("background_contact");
var studio_info_ctx=get_canvas_element_by_id("background_studio_info");


var global_time=0;
var index_canvas_size={width:$(".row_index").outerWidth(),height:$(".row_index").outerHeight()};

function main_ani_frame() {
   global_time+=3;
  draw_index(index_ctx,global_time);
  draw_intro(intro_ctx,global_time);
  draw_contact(contact_ctx,global_time);
  draw_studio_info(studio_info_ctx,global_time);
  requestAnimationFrame(main_ani_frame);
}
requestAnimationFrame(main_ani_frame);
var finish_flag=true;
var sending_reg_mail=false;
$(".submitbtn").click(function(){
  
  var inputlist=[
    {colname:"姓名",el:"#reg_name"},
    {colname:"信箱",el:"#reg_email"},
    {colname:"手機",el:"#reg_phone"},
    {colname:"內容",el:"#reg_content"}
  ];
  
  var maildata={
    reg_name: $("#reg_name").val(), 
    reg_email: $("#reg_email").val(),
    reg_phone: $("#reg_phone").val(),
    reg_content: $("#reg_content").val()
  };
  finish_flag=true;
  
  for(var i=0;i<inputlist.length;i++){
    if ($(inputlist[i].el).val()==""){
      finish_flag=false;
      $(inputlist[i].el).css("border","solid 1px red");
    }else{
      $(inputlist[i].el).css("border","");
    }
  }
  if (!finish_flag){
    alert("資料未填寫完整!");
  }else if (sending_reg_mail){
    alert("報名信寄送中...請稍後");
  }else{
    sending_reg_mail=true;
    
    $(".submitbtn").text("聯絡信寄送中...請稍後");
    
    //maildata.mail_addr="frank890417@gmail.com";
    $.ajax({
      url: "http://dyverse.studio/mail/testmail.php",
      data: maildata,
      success: function(res){
        if (res=="Y"){
          $(".submitbtn").text("聯絡信寄出成功! 請靜待回覆");
          setTimeout(function(){
            sending_reg_mail=false;
            $(".submitbtn").text("送出");
          },500);
        }else{
          $(".submitbtn").text("聯絡信寄出失敗..請再試一次");
          sending_reg_mail=false;
        }
      }
    });
    
  }
});

$(window).resize(initial_canvas);

function initial_canvas(){
  $("#background_index").attr({
    "width": $(".row_index").outerWidth()+"px",
    "height": $(".row_index").outerHeight()+"px"
  });
  $("#background_intro").attr({
    "width": $(".row_about").outerHeight()+"px",
    "height": $(".row_about").outerHeight()+"px"
  })
  $("#background_contact").attr({
    "width": $(".row_contact").outerWidth()+"px",
    "height": $(".row_contact").outerHeight()+"px"
  })
   $("#background_studio_info").attr({
    "width": $(".row_studio_info").outerWidth()+"px",
    "height": $(".row_studio_info").outerHeight()+"px"
  })
  mpos={x: $(".row_index").outerWidth()/2,y:$(".row_index").outerHeight()/2};
  
  sinfo_p={x:$(".row_studio_info").outerWidth()-200,y:$(".row_studio_info").outerHeight()/2};

  
  
  
  
  index_canvas_size={width:$(".row_index").outerWidth(),height:$(".row_index").outerHeight()};

}
var mouse={x:0,y:0};
var mm=false;
$(window).mousemove(function(evt){
  mouse.x=evt.pageX;
  mouse.y=evt.pageY;
  
  mm=true;

});
initial_canvas();

var pagewave=10;
var pagewave_range={min: 10,max: 50};
var pagewave_offset=0;
var pagewave_act=0;
$( window ).scroll(function() {
  pagewave+=(pagewave_range.max-pagewave)*0.02;
  pagewave_offset++;
  pagewave_act/5;
});



function draw_index(ctx,time){
  ctx.clearRect(0,0,2000,2000);
  for(var cc=0;cc<5;cc++){
    var baser =300+cc*150-mouse.y/100+mouse.x/100;
    ctx.beginPath(); 
    //ctx.moveTo(mpos.x+baser,mpos.y);
    for(var i=0;i<360;i++){
      var ang=i;
      var radang=2*Math.PI*ang/360+cc+((cc+i*(cc%(3)))%(cc+4))*20+mouse.x/100;
      var nowr=1.5*(Math.sin((10+Math.sin(time/(400-cc*10))+cc/2)*radang+time/40+mouse.x/100)*(10+100/time))+baser+Math.random()*cc;
      ctx.lineTo(mpos.x+nowr*Math.cos(radang),mpos.y+nowr*Math.sin(radang));
    }
    //ctx.lineTo(mpos.x+baser,mpos.y);
    ctx.strokeStyle="rgba(201,160,99,"+(Math.abs(6-cc)/30)+")";
    ctx.stroke();
    
  }
  ctx.beginPath(); 
  ctx.moveTo(0,index_canvas_size.height);
  ctx.lineTo(0,index_canvas_size.height-30);
  for(var i=0;i<=index_canvas_size.width;i++){
    ctx.lineTo(i,index_canvas_size.height-30+(pagewave+Math.sin((pagewave_offset*3+time)/30))*Math.sin(i/(Math.sqrt(i)+100+(-90/pagewave_act))+time/60+window.scrollY/100));
  }
  ctx.lineTo(index_canvas_size.width,index_canvas_size.height-30);
  ctx.lineTo(index_canvas_size.width,index_canvas_size.height);
  ctx.fillStyle="rgb(201,160,99)";
  ctx.fill();
  ctx.stroke();
  pagewave+=(pagewave_range.min-pagewave)*0.05;
  pagewave_act++;
}

var creatures=[];
var cr_default={
  p: {
    x: 300,
    y: 300
  },
  width: 1,
  doubletime: 55,
  live: 100,
  ori_doubletime: 55,
  ori_live: 120,
  v: {
    x: 2,
    y: 2
  }
};
for(i=0;i<10;i++){
  creatures.push(jQuery.extend(true, {}, cr_default));
}

function draw_intro(ctx,time){
  
  
  
  var ori_length=creatures.length;
  var deleteid=[];
  
  var inc_mos={
    x: mouse.x,
    y: mouse.y-$(".row_about").offset().top
  };
  
 
  

  for(var cc=0;cc<ori_length;cc++){
    var cr=creatures[cc];
    
    if (mm){
      cr.v.x+=(0.5-Math.random())*4;
      cr.v.y+=(0.5-Math.random())*4;
      cr.width+=Math.random()/60;
      if (Math.random()<0.001 && typeof mouse.x !== "undefined")
      {
        var new_cr=jQuery.extend(true, {}, cr_default);
        new_cr.p.x=inc_mos.x;
        new_cr.p.y=inc_mos.y;
        creatures.push(new_cr);
        
      }
      cr.p.x+=(inc_mos.x-cr.p.x)*0.05*Math.random();
      cr.p.y+=(inc_mos.y-cr.p.y)*0.05*Math.random();
    }
    if (mouse_down){
      cr.p.x+=(inc_mos.x-cr.p.x)*0.05*Math.random();
      cr.p.y+=(inc_mos.y-cr.p.y)*0.05*Math.random();
    }
    cr.width+=Math.abs(Math.sin(time/100))/50;
    if (cr.live>=0){
      cr.p.x+=cr.v.x;
      cr.p.y+=cr.v.y;
      cr.v.x*=0.99;
      cr.v.y*=0.99;
      cr.live--;
      cr.v.x+=0.5-Math.random();
      cr.v.y+=0.5-Math.random();
      
      
      cr.doubletime--;
      if (cr.doubletime<=0 && ori_length<220){
        cr.doubletime=cr.ori_doubletime;

        var ax=2.5-Math.random()*5;
        var ay=2.5-Math.random()*5;

        var new_cr = jQuery.extend(true, {}, cr);
        new_cr.type=(Math.random()<0.2?"line":"fill");
        new_cr.ori_live=Math.random()*200+100;
        new_cr.live=new_cr.ori_live;
        new_cr.width=Math.random()*2+0.2;
        new_cr.ori_doubletime=Math.random()*20+30;
        new_cr.doubletime=new_cr.ori_doubletime;
        new_cr.v.x+=ax;  new_cr.v.y+=ay;
        cr.v.x-=ax;  cr.v.y-=ay;

        creatures.push(new_cr);

      }
    
    }
    
  }
  var newlist=[];
  for(var cc=0;cc<creatures.length;cc++){
    var cr=creatures[cc];
    if (cr.live>0 && cr.p.x>-500 && cr.p.y>-500  && cr.p.y<$("#background_intro").height()+500 && cr.p.x<$("#background_intro").width()+500
    ){
        newlist.push(cr);
    }
  }
  creatures=newlist;
  ctx.clearRect(0,0,2000,2000);
  
  //draw mouse
  ctx.beginPath();
  ctx.arc(inc_mos.x+10,inc_mos.y+10,3,0,2*Math.PI);
  ctx.fillStyle="rgb(255,255,255)";
  ctx.strokeStyle="rgb(255,255,255)";
  ctx.fill();
  
  //draw all
  var last_cr;
   for(var cc=0;cc<creatures.length;cc++){
      var cr=creatures[cc];
     
      ctx.beginPath();
      ctx.arc(cr.p.x,cr.p.y,cr.width>cr.live?cr.live:cr.width,0,2*Math.PI);
      ctx.fillStyle="rgb(255,255,255)";
      ctx.strokeStyle="rgb(255,255,255)";
      if (cr.type=="line")
        ctx.stroke();
      else
        ctx.fill();
     if (Math.random()<3 && last_cr){
       ctx.beginPath();
       ctx.moveTo(last_cr.p.x,last_cr.p.y);
       ctx.lineTo(cr.p.x,cr.p.y);
       ctx.strokeStyle="rgba(255,255,255,"+1/(cc/10+5)+")";
       ctx.stroke();
     }
     last_cr=cr;
  }
  
  mm=false;
}


$(".contactform").keydown(function(e){
  contact_noise_height=200;
});
var contact_noise_height=200;
function draw_contact(ctx,time){
  ctx.clearRect(0,0,2000,2000);
  ctx.beginPath(); 
  ctx.moveTo(0,index_canvas_size.height);
  ctx.lineTo(0,index_canvas_size.height-30);
  for(var i=-200;i<=index_canvas_size.width+200;i+=3){
    var newy=Math.random()*contact_noise_height-contact_noise_height/2+index_canvas_size.height/2;
    ctx.lineTo(i,newy);
  }
  
  ctx.strokeStyle="rgb(201,160,99)";
  ctx.stroke();
  contact_noise_height*=0.9;
  //ctx.stroke();
}

var sinfo_p={x:$(".row_studio_info").outerWidth()-250,y:$(".row_studio_info").outerHeight()/2};

function draw_studio_info(ctx,time){
  ctx.clearRect(0,0,2000,2000);
  
  //calculate
  
  //繪製角度sin線
  ctx.strokeStyle="rgb(201,160,99)";
  
  var ck_angle=(Math.sin(time/170)*3/360)*2*Math.PI;
  
  var sinfo_angle=(20.5/360)*2*Math.PI;
  var var_sinfo_p={
    x:sinfo_p.x+Math.cos(sinfo_angle)*ck_angle*-250,
    y:sinfo_p.y+Math.sin(sinfo_angle)*ck_angle*-250
  };
  
  
  //draw dot
  ctx.beginPath();
  ctx.arc(var_sinfo_p.x,var_sinfo_p.y,5,0,2*Math.PI);
  ctx.fillStyle="rgb(201,160,99)";
  ctx.lineWidth=3;
  ctx.strokeStyle="rgb(201,160,99)";
  // ctx.fill();
  ctx.stroke();
  
  
  
  //draw angle wave lines
  ctx.lineWidth=1;
  
  var angle=(-55.0/360)*2*Math.PI;
  
  ctx.beginPath(); 
  ctx.moveTo(var_sinfo_p.x,var_sinfo_p.y);
  // ctx.lineTo(0,index_canvas_size.height-30);
  for(var i=var_sinfo_p.x;i<=index_canvas_size.width+200;i+=3){
    var var_angle=angle+(Math.sin(time/200+i/20)/360)*2*Math.PI/5+ck_angle;
    var len=i-var_sinfo_p.x;
    var newx=var_sinfo_p.x+Math.cos(var_angle)*len;
    var newy=var_sinfo_p.y+Math.sin(var_angle)*len;
  
    ctx.lineTo(newx,newy);
  }
  ctx.stroke();
  
  
  var angle=(-140.0/360)*2*Math.PI;
  
  ctx.beginPath(); 
  ctx.moveTo(var_sinfo_p.x,var_sinfo_p.y);
  // ctx.lineTo(0,index_canvas_size.height-30);
  for(var i=var_sinfo_p.x;i<=index_canvas_size.width+1200;i+=3){
    var var_angle=(angle+(2*Math.sin(time/(200)+Math.abs(var_sinfo_p.x-i)/(50-(3+ck_angle)*9))/360)*2*Math.PI);
    var len=i-var_sinfo_p.x;
    var newx=var_sinfo_p.x+Math.cos(var_angle)*len;
    var newy=var_sinfo_p.y+Math.sin(var_angle)*len;
  
    ctx.lineTo(newx,newy);
  }
  ctx.stroke();
  
  var angle=(96.0/360)*2*Math.PI;
  
  ctx.beginPath(); 
  ctx.moveTo(var_sinfo_p.x,var_sinfo_p.y);
  // ctx.lineTo(0,index_canvas_size.height-30);
  for(var i=var_sinfo_p.x;i<=index_canvas_size.width+200;i+=3){
    var var_angle=angle+(Math.sin(time/200+i/20)/360)*2*Math.PI/5-ck_angle;
    var len=i-var_sinfo_p.x;
    var newx=var_sinfo_p.x+Math.cos(var_angle)*len;
    var newy=var_sinfo_p.y+Math.sin(var_angle)*len;
  
    ctx.lineTo(newx,newy);
  }
  ctx.stroke();
  
  contact_noise_height*=0.9;
  //ctx.stroke();
}



if (window.location.href.indexOf("frank890417")==-1 && window.location.href.indexOf("boomerang")==-1){

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52977512-7', 'auto');
  ga('send', 'pageview');
}else{
  console.log("detect in codepen or screen mode! no GA!");
}

